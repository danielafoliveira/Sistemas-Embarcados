\section{Desenvolvimento}


\subsection{Descrição do Hardware}

Foi montado um sistema de ativação da trava eletrônica. Utilizando os seguintes materiais:

\begin{itemize}
\item Trava solenoide 12V (figura \ref{trava});
\item Fonte DC 12V;
\item Resistor de 1 KOhm;
\item Transistor NPN (TIP41);
\item Jumpers
\item Protoboard
\item Push-buttom
\item Chave 3 pinos
\end{itemize}


\begin{figure}[h!]
\caption{Trava eletrônica solenoide 12V}
\centering % para centralizarmos a figura
\includegraphics[width=5cm]{trava.jpg} % leia abaixo
\label{trava}
\end{figure}

Na protoboard foi montado o circuito da figura \ref{circuito}.

\begin{figure}[h!]
\caption{Ativação da trava eletrônica solenoide 12V}
\centering % para centralizarmos a figura
\includegraphics[width=5cm]{circuito_trava.jpg} % leia abaixo
\label{circuito}
\end{figure}

O pino de entrada foi conectado à GPIO4 da Raspberry Pi 3 para que fossem enviados os comandos para abrir a porta. 

A trava solenoide mantem a porta fechada até que seja inserida uma tensão de 12V em seus terminais. Neste momento, o solenoide faz com que o ''dente'' da trava seja retraído, liberando a abertura da porta. Ao retirar a tensão dos terminais, uma mola retorna a trava para a posição original, travando a porta novamente. [1]

Foi utilizada uma fonte DC de 12V - 2A com conexão Jack P4, ligada na protoboard com um conector Jack P4 fêmea.

Foi conectada uma caixa de som à saída P2 da Raspberry Pi para reproduzir sons de confirmação ou negação de acesso.


Para receber a requisição de acesso, foi montado um circuito com botão em modo Pull-Up, como mostra o esquematico da figura \ref{botao}

\begin{figure}[h!]
\caption{Botão em modo Pull-Up}
\centering % para centralizarmos a figura
\includegraphics[width=5cm]{circuito_botao.jpg} % leia abaixo
\label{botao}
\end{figure}

Foi utilizada a câmera NoIR da Raspberry Pi, conectada por meio do cabo flat (figura \ref{camera}).

\begin{figure}[h!]
\caption{Câmera NoIR utilizada no projeto}
\centering % para centralizarmos a figura
\includegraphics[width=8cm]{camera.jpeg} % leia abaixo
\label{camera}
\end{figure}

Prevendo que um malfeitor poderia arrombar a porta, notou-se a necessidade de instalar uma chave de fim de curso nesta, para identificar se ela encontra-se aberta ou fechada.

Obs: Para este ponto de controle, a chave de fim de curso foi simulada por uma chave comum, e será substituida quando a porta for construida.

\subsection{Descrição do Software}

Foi criado um sistema cliente-servidor utilizando o protocolo TCP para efeturar a comunicação com o administrador de forma remota. O servidor foi instalado na Raspberry Pi presente na central de comando da porta, e o cliente será executado na máquina do administrador. O cliente envia os comandos pela rede, e o servidor os escreve no arquivo \textit{msgs$\_$admin.txt}, assim, o programa principal pode ler os comandos.

Foi criada uma função principal contendo todas as chamadas necessárias para a execução do sistema.
No programa, são criados dois processos filhos, mostrados na figura \ref{geral}.


\begin{figure}[h!]
\caption{Visão geral}
\centering % para centralizarmos a figura
\includegraphics[width=10cm]{geral.png} % leia abaixo
\label{geral}
\end{figure}


Filho 1: Executa as rotinas de verificação e controle da porta, tais como: verificação da campainha, verificação do estado da porta, ativação do alarme (caso a porta seja aberta sem permissão)

Filho 2: Executa o servidor

No filho 1, são criadas threads para cada elemento, pois todos precisam ser verificados simultaneamente.


A thread da campainha, cujo funcionamento é mostrado na figura \ref{camp}, é responsável por verificar mudanças no estado do botão (através da função poll), iniciar a rotina de verificação, e decidir se a porta será aberta ou não. Caso o acesso seja negado, é dada a opção de cadastro.
A rotina de reconhecimento só é acionada com a porta fechada e quando o alerta de invasão está desativado.

\begin{figure}[h!]
\caption{Thread da Campainha}
\centering % para centralizarmos a figura
\includegraphics[width=10cm]{camp.png} % leia abaixo
\label{camp}
\end{figure}

A thread da porta, explicada pelo diagrama da figura \ref{porta} é responsável por verificar se a porta encontra-se aberta ou fechada. Como sistema de segurança, se a porta estiver aberta com a flag \textit{reconhecido} = 0, é emitido um alerta, indicando uma invasão.

\begin{figure}[h!]
\caption{Thread da Porta}
\centering % para centralizarmos a figura
\includegraphics[scale = 0.5]{porta.png} % leia abaixo
\label{porta}
\end{figure}

A thread do alarme é responsavel apenas por manter o alarme sonoro ligado, caso a flag \textit{alerta} esteja setada, como mostra a figura \ref{alarme}.

\begin{figure}[h!]
\caption{Thread do Alarme}
\centering % para centralizarmos a figura
\includegraphics[scale = 0.5]{alarme.png} % leia abaixo
\label{alarme}
\end{figure}





