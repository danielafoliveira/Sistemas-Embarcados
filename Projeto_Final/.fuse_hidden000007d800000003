#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <sys/poll.h>
#include <unistd.h>

#include "funcoes.h"


int poll_bot(int pin)
{
	int estado;
	struct pollfd pfd;
	char buffer;
	system("echo" pin " > /sys/class/gpio/export");
	system("echo both > /sys/class/gpio/gpio "pin"/edge");
	system("echo in      > /sys/class/gpio/gpio"pin"/direction");
	pfd.fd = open("/sys/class/gpio/gpio"pin"/value", O_RDONLY);
	if(pfd.fd < 0)
	{
		puts("Erro abrindo /sys/class/gpio/gpio"pin"/value");
		puts("Execute este programa como root");
		return -1;
	}
	read(pfd.fd, &buffer, 1);
	pfd.events = POLLPRI | POLLERR;
	pfd.revents = 0;
	puts("Augardando botao");
	poll(&pfd, 1, -1);
	if(pfd.revents) puts("mudanca do botao");
	estado = pfd.fd;
	close(pfd.fd);
	system("echo "pin" > /sys/class/gpio/unexport");
	return estado;
}
